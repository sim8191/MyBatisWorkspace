<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="emp">
<!-- namespace="메퍼파일의 고유한이름" -->
<!-- mybatis-config에서 마이바티스 작성하고 와야 해 -->
	<select id="search1" resultType="map">
		SELECT *
		FROM EMP
		<!-- 
			검색조건이 사번인 경우
			WHERE EMP_ID LIKE '%검색키워드%'
			
			검색조건이 사원명인 경우
			WHERE EMP_NAME LIKE...
			
			이메일인 경우 EMAIL
			
			전화번호인 경우 PHONE
			
			검색조건에 따라 서로다른 칼럼을 통해 조건식이 작성하는 경우
			${value}를 사용하여 해결할수 있다.
			
			${value} : 일반 데이터 바인딩시 사용
			${value} : 테이블명, 칼럼명, 예약어 등을 바인딩할때 사용
			
		 -->
		WHERE ${searchType} LIKE '%' || #{searchKeyWord}|| '%'
		ORDER BY EMP_ID DESC
	</select>
	
	<select id="selectAll" resultType="map">
		SELECT *
		FROM EMP
		ORDER BY EMP_ID DESC
	</select>
	
	<select id="search2" resultType="map">
		SELECT *
		FROM (
			SELECT E.* 
			, DECODE(SUBSTR(EMP_NO,8,1),'1','남','3','남','여') AS "GENDER"
			FROM EMP E
		)
		<!-- 
			where태그는 몸통부분이 비어있다면 where키워드를 제거하고,
			where 내부에 AND나 OR로 시작하는 코드가 있다면 이를 제거한다.
		 -->
		<where>
			<if test="searchType != null and searchType != ''">
				AND ${searchType} LIKE '%' || #{searchKeyWord}|| '%'
			</if>
			<if test="gender != null and gender != ''">
				AND GENDER = #{gender}
			</if>
			<if test="salary != null and salary != 0">
				<if test="salaryCompare != null and salaryCompare != ''">
					<!-- mybatis식 if-else문 -->
					<choose>
						<when test="salaryCompare == ge">
							AND SALARY >= #{salary}
						</when>
						<otherwise>
						<!-- 
							CDATA태그
							XML의 entity문자를 문자 그대로 이스케이핑하고자 할때 
							사용하는 태그
						 -->
							AND SALARY <![CDATA[<=]]> #{salary}
						</otherwise>
					</choose>
				</if>
			</if>
			<if test="hire_date neq null and hire_date neq ''">
				<if test="hiredateCompare != null  and hiredateCompare != ''">
					<choose>
						<when test="hiredateCompare.equals('ge')">
							AND HIRE_DATE >= #{hire_date}
						</when>
						<otherwise>
							AND HIRE_DATE <![CDATA[<=]]> #{hire_date}
						</otherwise>
					</choose>
				</if>
			</if>
		</where>
	</select>
	
	<select id="selectJobList" resultType="map">
		SELECT
			JOB_CODE, JOB_NAME
		FROM JOB
		
	</select>
	<!-- 컬렉션(배열) 형태의 데이터를 바인딩 -->
	<select id="search3" resultType="map">
		SELECT *
		FROM EMP E
		LEFT JOIN DEPT D ON (DEPT_CODE = DEPT_ID)
		LEFT JOIN JOB J ON (E.JOB_CODE = J.JOB_CODE)
		<where>
			<if test="arr != null">
				E.JOB_CODE IN
				<foreach item="jobcode" collection="arr" separator=","
				open="(" close=")">
					#{jobcode}
				</foreach><!-- 시작시 자동으로 ( 끝나면 자동으로) 찍음 그리고,찍으면서 데이터가 싸임 -->
			</if>
		</where>
		
		<!-- WHERE JOB_CODE IN ('J1','J2','J3'....) -->
		
	</select>
	
	
	
	
	
	
	
</mapper>